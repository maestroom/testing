/*!
 * @package   yii2-dynagrid
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2015
 * @version   1.4.5
 *
 * JQuery Plugin for yii2-dynagridDetail. Allows saving/deleting the dynagridDetail 
 * filter or sort details.
 * 
 * Author: Kartik Visweswaran
 * Copyright: 2015, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */!function(e){"use strict";var t=function(t,n){return null===t||void 0===t||t===[]||""===t||n&&""===e.trim(t)},n=function(t,n){var i=this;i.$element=e(t),e.each(n,function(e,t){i[e]=t}),i.init(),i.listen()};n.prototype={constructor:n,init:function(){var t=this,n=e("#"+t.modalId),i=e("#"+t.dynaGridId),a=t.$element.closest("form");n.insertAfter(i),t.$form=a,t.$formContainer=a.parent(),t.$btnSave=a.find(".dynagrid-detail-save"),t.$btnDelete=a.find(".dynagrid-detail-delete"),t.$list=a.find(".dynagrid-detail-list"),t.$name=a.find(".dynagrid-detail-name")},process:function(t){var n=this;e.ajax({type:"post",url:t,dataType:"json",data:n.$form.serialize(),beforeSend:function(){n.$form.hide(),n.$formContainer.prepend(n.submitMessage)},success:function(e){"success"===e.status&&n.$formContainer.html(e.content)}})},listen:function(){var n=this,i=n.$form,a=n.$formContainer,d=n.$list;n.$btnSave.on("click",function(t){if(e("#dynagridsettings-name").length&&""==e.trim(e("#dynagridsettings-name").val()))return e("#dynagridsettings-name").blur(),!1;t.preventDefault(),i.hide(),a.prepend(n.submitMessage),setTimeout(function(){var t=i.attr("action");e.ajax({type:"POST",url:t,data:i.serialize(),dataType:"json",encode:!0,success:function(i){e("#"+n.modalId).hide(),e.pjax.defaults.url=t,e.pjax.defaults.push=!1,e.pjax.reload("#"+n.dynaGridId+"-pjax",e.pjax.defaults)}})},1e3)}),n.$btnDelete.on("click",function(){t(n.$element.val())?i.trigger("reset.yiiActiveForm"):window.confirm(n.deleteConfirmation)&&(i.find('input[name="deleteDetailFlag"]').val(1),i.hide(),a.prepend(n.deleteMessage),setTimeout(function(){i.submit()},1e3))}),d.on("change",function(){var a=d.val(),r=d.find("option:selected").text();t(a)||(n.$element.val(a),n.$name.val(r),e.ajax({type:"post",url:n.configUrl,dataType:"json",data:n.$form.serialize(),success:function(e){"success"===e.status&&i.find(".dynagrid-settings-text").html(e.content)}}))}),i.off("afterValidate").on("afterValidate",function(t,n){e.each(n,function(e,t){if(t.length>0)return i.show(),a.find(".dynagrid-submit-message").remove(),!0})})}},e.fn.dynagridDetail=function(t){var i=Array.apply(null,arguments);return i.shift(),this.each(function(){var a=e(this),d=a.data("dynagridDetail"),r="object"==typeof t&&t;d||(d=new n(this,e.extend({},e.fn.dynagridDetail.defaults,r,e(this).data())),a.data("dynagridDetail",d)),"string"==typeof t&&d[t].apply(d,i)})},e.fn.dynagridDetail.defaults={submitMessage:"",deleteMessage:"",deleteConfirmation:"Are you sure you want to delete all your grid personalization settings?",configUrl:"",modalId:"",dynaGridId:""}}(window.jQuery);